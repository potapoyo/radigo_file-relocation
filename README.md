# Radio File Organizer for Google Drive

このプロジェクトは、ラジオ録音ファイル（.aac形式）をGoogle Drive上で自動的に整理するためのPythonスクリプトです。GitHub Actionsを利用して定期的に実行され、サービスアカウント認証を用いることで、ユーザーの操作なしに安全な自動化を実現します。

## 主な機能

*   **ファイルの自動整理**: Google Drive上の指定フォルダにある `.aac` ファイルを、放送局や番組ごとに分類されたフォルダへ自動で移動します。
*   **サービスアカウント認証**: ユーザーの個人アカウントではなく、サーバー間連携に適したサービスアカウントを使用するため、安全かつ自動化に適しています。
*   **設定ベースの動作**: `settings.yaml` の内容をGitHub Secretsに設定することで、動作を柔軟にカスタマイズできます。
*   **定期実行**: GitHub Actionsにより、週に一度（日本時間の日曜午前12時）自動で実行されます。
*   **手動実行も可能**: GitHub Actionsの画面から、いつでも好きなタイミングで手動実行できます。
*   **ドライランモード**: `--dry-run` オプションを有効にすることで、実際のファイル移動を行わずに処理の流れを確認できます。
*   **ログ出力**: 処理の進行状況やエラー情報をログファイル (`logs/` ディレクトリ内) に記録します。

## 必要なもの

*   Google Cloud Platform (GCP) プロジェクト
    *   **Google Drive API** が有効になっていること
    *   **サービスアカウント**と、その認証情報である**JSONキーファイル**
*   整理対象のファイルが保存されているGoogle Driveフォルダ
*   整理後のファイルを保存するGoogle Driveフォルダ

---

## セットアップ手順

このスクリプトを自分の環境で動かすには、以下の手順に従って設定を行ってください。

### 1. このリポジトリをフォーク

まず、画面右上にある「Fork」ボタンをクリックして、このリポジトリを自分のGitHubアカウントにコピーします。

### 2. Google Cloud Platform (GCP) でサービスアカウントを作成

1.  [GCPコンソール](https://console.cloud.google.com/)にアクセスし、GCPプロジェクトを選択または作成します。
2.  ナビゲーションメニューから「APIとサービス」 > 「有効なAPIとサービス」に移動し、「Google Drive API」が有効になっていることを確認します。（もしなければ、「+ APIとサービスの有効化」から有効にしてください。）
3.  次に、「APIとサービス」 > 「認証情報」に移動します。
4.  「+ 認証情報を作成」をクリックし、「サービスアカウント」を選択します。
5.  サービスアカウント名（例: `radio-file-organizer`）を入力し、「作成して続行」をクリックします。
6.  ロールの選択は不要です。「続行」をクリックし、「完了」します。
7.  作成したサービスアカウントのメールアドレス（`...@...iam.gserviceaccount.com`）をコピーしておきます。これは次のステップで使います。
8.  作成したサービスアカウントの「操作」列にある「︙」をクリックし、「鍵を管理」を選択します。
9.  「鍵を追加」 > 「新しい鍵を作成」を選択し、キーのタイプとして「**JSON**」を選んで「作成」をクリックします。
10. JSONファイルが自動的にダウンロードされます。**このファイルは非常に重要なので、安全な場所に保管してください。**

### 3. Google Drive フォルダの準備と共有

1.  Google Driveで、整理したいファイルが置かれているフォルダ（入力フォルダ）と、整理後のファイルの保存先フォルダ（出力フォルダ）を準備します。
2.  **両方のフォルダ**に対して、以下の共有設定を行ってください。
    *   フォルダを右クリックし、「共有」を選択します。
    *   「ユーザーやグループと共有」の入力欄に、先ほどコピーしたサービスアカウントのメールアドレスをペーストします。
    *   権限を「**編集者**」に設定し、「送信」をクリックします。

    *これにより、サービスアカウントがフォルダ内のファイルを読み書きできるようになります。*

### 4. GitHub リポジトリの Secrets を設定

Forkした自分のリポジトリのページを開き、「Settings」 > 「Secrets and variables」 > 「Actions」に移動します。
以下の2つの**リポジトリシークレット (Repository secrets)** を新規に作成します。

*   **`GDRIVE_SERVICE_ACCOUNT_JSON`**
    *   `Name`: `GDRIVE_SERVICE_ACCOUNT_JSON`
    *   `Secret`: ダウンロードしたサービスアカウントの**JSONファイルの中身をすべてコピー＆ペースト**します。

*   **`SETTINGS_YAML_CONTENT`**
    *   `Name`: `SETTINGS_YAML_CONTENT`
    *   `Secret`: 以下の内容を貼り付け、`<...>` の部分を自分の環境に合わせて書き換えます。

    ```yaml
    # Google Driveの出力先フォルダID（整理したいファイルが置かれているフォルダ）
    # フォルダのURL (https://drive.google.com/drive/folders/XXXXXXXX) の XXXの部分です。
    output_folder_id: <入力フォルダのID>

    # Google Drive内の基本的な保存先パス（整理後のファイルの保存先）
    # 例: "整理済みラジオ/"
    target_folder_path: <出力フォルダのパス>

    # サービスアカウントの認証情報JSONファイルへのパス (この行は変更しないでください)
    service_account_credentials_file: service_account.json
    ```

---

## 実行方法

### 自動実行

設定が完了すれば、毎週日曜日の午前12時（日本時間）に自動でスクリプトが実行されます。

### 手動実行

1.  リポジトリの「Actions」タブを開きます。
2.  左側のサイドバーから「Organize Radio Files」ワークフローを選択します。
3.  「Run workflow」というドロップダウンボタンが表示されるので、それをクリックして実行します。

## ログの確認

スクリプトが正しく実行されたか、またはエラーが発生していないかは、Actionsの実行ログで確認できます。

1.  「Actions」タブから、確認したいワークフローの実行履歴をクリックします。
2.  `organize` ジョブをクリックし、`Run script` ステップを展開すると、スクリプトの出力ログ（どのファイルがどこに移動されたかなど）が表示されます。

## ライセンス

このプロジェクトは [MIT License](./LICENSE) のもとで公開されています。
